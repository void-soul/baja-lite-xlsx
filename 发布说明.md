# 发布配置总结

## ✅ 当前配置（源码发布模式）

### 已完成的配置

1. **package.json 优化**
   - `"install": "node-gyp rebuild"` - 用户安装时自动编译
   - `"build:dev": "node-gyp rebuild && npm run copy-dlls:dev"` - 开发时使用
   - 移除了硬编码的 DLL 路径依赖

2. **.npmignore 配置**
   - 排除 build/ 目录（编译产物）
   - 排除 node_modules/
   - 排除测试文件
   - 排除临时文件

3. **发布文档**
   - ✅ PUBLISH_GUIDE.md - 开发者发布指南
   - ✅ INSTALLATION.md - 用户安装指南

---

## 📦 发布流程

### 快速发布（推荐）

```bash
# 1. 清理和测试
npm run clean
npm install
npm test
npm run example:json

# 2. 检查将要发布的内容
npm pack --dry-run

# 3. 更新版本号
npm version patch  # 1.0.0 -> 1.0.1

# 4. 发布
npm publish
```

### 发布内容清单

**会发布的文件:**
- ✅ `src/` - C++ 源代码
- ✅ `binding.gyp` - 编译配置
- ✅ `index.js` - 主入口
- ✅ `index.d.ts` - TypeScript 类型定义
- ✅ `package.json`
- ✅ `README.md`
- ✅ `LICENSE`
- ✅ `examples/` - 示例代码（可选）

**不会发布的文件:**
- ❌ `build/` - 编译产物
- ❌ `*.node` - 二进制文件
- ❌ `node_modules/`
- ❌ `test/` - 测试文件
- ❌ 临时文件和调试文件

---

## 🔧 用户安装流程

### 用户执行 `npm install baja-lite-xlsx` 时发生什么？

1. **下载源码包** - 从 npm 下载你发布的源码
2. **执行 install 脚本** - 自动运行 `node-gyp rebuild`
3. **编译 C++ 代码** - 在用户机器上编译
4. **生成 .node 文件** - 编译产物在用户的 node_modules/baja-lite-xlsx/build/ 目录
5. **完成安装**

### 用户需要的环境

**Windows:**
- Visual Studio Build Tools
- Python
- vcpkg + xlnt

**Linux:**
- build-essential
- cmake
- vcpkg + xlnt

**macOS:**
- Xcode Command Line Tools
- cmake  
- vcpkg + xlnt

---

## ⚠️ 注意事项

### 1. 用户安装可能遇到的问题

❌ **没有编译环境**
```
gyp ERR! find VS
```
解决：引导用户查看 INSTALLATION.md

❌ **找不到 xlnt**
```
fatal error: xlnt/xlnt.hpp: No such file or directory
```
解决：需要用户安装 vcpkg 和 xlnt

❌ **编译时间长**
- 首次安装可能需要 5-10 分钟

### 2. 降低用户安装难度的建议

#### 选项A: 提供详细文档（当前方案）✅
- ✅ 已创建 INSTALLATION.md
- ✅ 在 README 中突出安装要求
- ✅ 提供常见问题解决方案

#### 选项B: 使用 prebuild（未来优化）
```bash
# 安装 prebuild 工具
npm install --save-dev prebuild prebuild-install

# 为各平台预编译
npm run prebuild

# 上传到 GitHub Releases
npm run upload
```

优点：用户无需编译环境
缺点：需要维护多平台的预编译包

---

## 📋 发布前最后检查

运行以下命令确保一切正常：

```bash
# 1. 检查版本号
cat package.json | grep version

# 2. 检查发布内容
npm pack --dry-run

# 3. 本地测试安装
mkdir test-install
cd test-install
npm install ../baja-lite-xlsx-1.0.0.tgz
node -e "console.log(require('baja-lite-xlsx'))"

# 4. 清理测试
cd ..
rm -rf test-install
```

---

## 🚀 首次发布完整流程

```bash
# 1. 登录 npm
npm login

# 2. 确认包名可用
npm search baja-lite-xlsx

# 3. 设置版本号
npm version 1.0.0

# 4. 预览发布内容
npm pack --dry-run

# 5. 发布
npm publish

# 6. 验证
npm info baja-lite-xlsx

# 7. 在新环境测试安装
cd /tmp
mkdir test-baja-lite-xlsx
cd test-baja-lite-xlsx
npm init -y
npm install baja-lite-xlsx
```

---

## 📝 版本管理建议

### 语义化版本 (Semantic Versioning)

- **补丁版本 (1.0.X)**: Bug 修复
  ```bash
  npm version patch
  ```

- **小版本 (1.X.0)**: 新功能，向后兼容
  ```bash
  npm version minor
  ```

- **大版本 (X.0.0)**: 破坏性变更
  ```bash
  npm version major
  ```

### 预发布版本

```bash
# Beta 测试
npm version prerelease --preid=beta
npm publish --tag beta

# 用户安装
npm install baja-lite-xlsx@beta
```

---

## 📊 发布后监控

### 查看下载统计
```bash
npm info baja-lite-xlsx
```

或访问：
- https://www.npmjs.com/package/baja-lite-xlsx
- https://npmtrends.com/baja-lite-xlsx

### 收集用户反馈
- 监控 GitHub Issues
- 查看 npm 包页面的问题报告
- 统计安装成功率

---

## 🔄 持续改进

1. **收集安装问题** - 前期会有用户反馈安装困难
2. **优化文档** - 根据反馈更新 INSTALLATION.md
3. **考虑 prebuild** - 如果安装问题多，考虑提供预编译包
4. **添加 CI/CD** - 自动化测试和发布流程

---

## ✅ 总结

**当前配置适合：**
- ✅ 开源项目
- ✅ 技术用户
- ✅ 可接受编译时间
- ✅ 需要支持多平台

**发布命令：**
```bash
npm version patch && npm publish
```

**用户安装：**
```bash
npm install baja-lite-xlsx
```

需要用户自行安装编译环境和 xlnt 库（参考 INSTALLATION.md）

